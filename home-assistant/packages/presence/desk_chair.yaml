---
homeassistant:
  customize:
    automation.presence_desk_chair:
      icon: mdi:chair-rolling

automation:
  - id: presence_desk_chair
    alias: Presence - Desk Chair
    mode: single
    trigger:
      - id: enter
        platform: state
        entity_id: sensor.latest_location
        to: Desk Chair
      - id: clear
        platform: state
        entity_id: sensor.latest_location
        from: Desk Chair
    action:
      - choose:
          - conditions: '{{ trigger.id == "enter"}}'
            sequence:
              - if:
                  - entity_id: sensor.phase_of_day
                    condition: state
                    state: Morning
                then:
                  - scene: scene.daytime
                  - service: switch.turn_off
                    target:
                      entity_id: switch.living_room_cam
                  - if:
                      - entity_id: sensor.phase_of_day
                        condition: state
                        state:
                          - Morning
                          - Daytime
                      - condition: state
                        entity_id: binary_sensor.desk_lamp_used_today
                        state: "off"
                      - condition: not
                        conditions:
                          - condition: state
                            entity_id: timer.desk_lamp_timer
                            state: active
                    then:
                      - service: timer.start
                        target:
                          entity_id: timer.desk_lamp_timer
          - conditions: '{{ trigger.id == "clear" }}'
            sequence:
              - service: switch.turn_off
                target:
                  entity_id: switch.desk_lamp
