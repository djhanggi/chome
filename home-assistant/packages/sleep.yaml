---
input_select:
  sleep_sound:
    name: "Sleep Sound"
    options:
      - Country
      - Rain
      - Rainforest
      - River
      - Thunderstorm
      - Waterfall

template:
  - sensor:
      - unique_id: sleep_sound_content_id
        name: "Sleep Sound Content ID"
        state: >
          {% set SOUNDS = {
              "Country": "https://storage.googleapis.com/relaxation-sounds/country_night_3600.mp3",
              "Rain": "https://storage.googleapis.com/relaxation-sounds/rain_3600.mp3",
              "Rainforest": "https://storage.googleapis.com/relaxation-sounds/rainforest_600.m4a",
              "River": "https://storage.googleapis.com/relaxation-sounds/river_3600.mp3",
              "Thunderstorm": "https://storage.googleapis.com/relaxation-sounds/thunderstorm_3600.mp3",
              "Waterfall": "https://storage.googleapis.com/relaxation-sounds/waterfall_600.m4a",
            } %}
          {% set state = states("input_select.sleep_sound") %}
          {{ SOUNDS[state] }}

script:
  randomize_sleep_sound:
    alias: "Randomize Sleep Sound"
    sequence:
      - service: input_select.select_option
        target:
          entity_id: input_select.sleep_sound
        data_template:
          option: >
            {{ state_attr("input_select.sleep_sound", "options") | random }}
  play_bedroom_sleep_sound:
    alias: "Play Bedroom Sleep Sound"
    sequence:
      - service: media_player.volume_set
        target:
          entity_id: media_player.bedroom_speaker
        data:
          volume_level: 0.20
      - service: media_player.play_media
        target:
          entity_id: media_player.bedroom_speaker
        data_template:
          media_content_id: >
            {{ states("sensor.sleep_sound_content_id") }}
          media_content_type: music
