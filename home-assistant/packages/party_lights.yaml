input_boolean:
  party_lights:
    name: Party Lights
    icon: mdi:party-popper
    initial: "off"

input_number:
  party_lights_speed:
    name: Party Lights Speed
    initial: 15
    min: 1
    max: 30
    step: 1

switch:
  - platform: template
    switches:
      party_lights:
        value_template: >
          {{ states("input_boolean.party_lights") }}
        friendly_name: "Party Lights"
        turn_on:
          - service: input_boolean.turn_on
            entity_id: input_boolean.party_lights
          - service: script.turn_on
            target:
              entity_id: script.party_lights_automation
        turn_off:
          - service: input_boolean.turn_off
            entity_id: input_boolean.party_lights
          - service: script.turn_off
            target:
              entity_id: script.party_lights_automation

light:
  - platform: group
    name: "Party Lights"
    unique_id: party_lights
    entities:
      - light.ceiling_e
      - light.ceiling_w
      - light.hallway_e
      - light.hallway_w
      - light.bathroom_e
      - light.living_room_lamp
      - light.bedroom_lamp
      - light.bed
  - platform: group
    name: "Party Lights - 1"
    unique_id: party_lights_1
    entities:
      - light.ceiling_w
      - light.hallway_w
      - light.living_room_lamp
      - light.bedroom_lamp
  - platform: group
    name: "Party Lights - 2"
    unique_id: party_lights_2
    entities:
      - light.ceiling_e
      - light.hallway_e
      - light.bathroom_e
      - light.bed

script:
  party_lights_automation:
    alias: "Party Lights"
    sequence:
      - repeat:
          while:
            - condition: state
              entity_id: input_boolean.party_lights
              state: "on"
          sequence:
            - service: script.party_lights
            - delay: "{{ states.input_number.party_lights_speed.state }}"
  party_lights:
    alias: "Party Lights"
    sequence:
      - service: light.turn_on
        data_template:
          entity_id: light.party_lights_1
          rgb_color:
            [
              "{{ (range(0, 255)|random) }}",
              "{{ (range(0, 255)|random) }}",
              "{{ (range(0, 255)|random) }}",
            ]
          brightness: "{{ (range(50, 250)|random) }}"
          transition: 0.1
      - service: light.turn_on
        data_template:
          entity_id: light.party_lights_2
          rgb_color:
            [
              "{{ (range(0, 255)|random) }}",
              "{{ (range(0, 255)|random) }}",
              "{{ (range(0, 255)|random) }}",
            ]
          brightness: "{{ (range(50, 250)|random) }}"
          transition: 0.1
